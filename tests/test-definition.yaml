# These tests can run against an OpenShift cluster, provided you note the following:
#
# 1. Set the "openshift" dimension below to "true" (with quotes)
# 2. Comment out the "true" option in the "s3-use-tls" dimension
#
# Regarding point 2.: the bitnami chart is used for S3 on OpenShift as it correctly installs
# a minio instance (the chart from minio does not correctly apply the service account to
# the job that creates the bucket, and so the permissions are not sufficient). However, it
# cannot correctly use self-signed TLS certificates due to a bug in libminioclient.sh: for
# non-OpenShift clusters the minio chart is thus used instead.
---
dimensions:
  - name: openshift
    values:
      - "false"
  - name: spark
    values:
      - 3.3.0-stackable0.0.0-dev
      - 3.4.0-stackable0.0.0-dev
  - name: ny-tlc-report
    values:
      - 0.1.0
  - name: s3-use-tls
    values:
      - "false"
      - "true"
tests:
  - name: smoke
    dimensions:
      - spark
      - s3-use-tls
      - openshift
  - name: pod_overrides
    dimensions:
      - spark
      - openshift
  - name: spark-history-server
    dimensions:
      - spark
      - s3-use-tls
      - openshift
  - name: spark-pi-private-s3
    dimensions:
      - spark
      - openshift
  - name: spark-pi-public-s3
    dimensions:
      - spark
      - openshift
  - name: spark-ny-public-s3
    dimensions:
      - spark
      - s3-use-tls
      - openshift
  - name: spark-examples
    dimensions:
      - spark
      - openshift
  - name: pyspark-ny-public-s3
    dimensions:
      - spark
      - openshift
  - name: pyspark-ny-public-s3-image
    dimensions:
      - spark
      - ny-tlc-report
      - openshift
  - name: resources
    dimensions:
      - spark
      - openshift
  - name: logging
    dimensions:
      - spark
      - ny-tlc-report
      - openshift
suites:
  - name: nightly
    patch:
      - dimensions:
          - expr: last
          - name: s3-use-tls
            expr: "true"
  - name: smoke-latest
    select:
      - smoke
    patch:
      - dimensions:
          - expr: last
  - name: openshift
    patch:
      - dimensions:
          - expr: last
          - name: openshift
            expr: "true"
          - name: s3-use-tls
            expr: "true"
